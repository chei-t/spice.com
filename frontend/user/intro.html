<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Welcome - Spice Store</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/png" href="../images/favicon.png" />
  <link rel="stylesheet" href="./css/intro.css">

</head>

<body>
  <!-- Animated Background -->
  <div id="creature-wrapper">
    <div id="creature"></div>
  </div>

  <!-- Onboarding Content -->
  <div class="onboard-container">
    <div class="illustration" id="onboard-bg"></div>

    <div class="content">
      <h2 id="onboard-title">Discover Premium Spices</h2>
      <p id="onboard-text">Hand-picked spices from around the world, curated for true flavor lovers.</p>
    </div>

    <div class="features" id="feature-badges">
      <div class="feature-badge">✓ 100% Natural</div>
      <div class="feature-badge">✓ Fresh Ground</div>
      <div class="feature-badge">✓ Fast Shipping</div>
    </div>

    <div class="controls">
      <div class="progress-wrapper">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>

      <div class="dots" id="dots-container">
        <span class="dot active"></span>
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>

      <div class="button-group">
        <button id="prev-btn" disabled>Back</button>
        <button id="next-btn">Next</button>
      </div>

      <a href="register.html" class="skip">Skip Introduction</a>
    </div>
  </div>

  <script type="module">
    import { animate, createTimeline, createTimer, stagger, utils } from 'https://esm.sh/animejs';

    const creatureEl = document.querySelector('#creature');
    const viewport = { w: window.innerWidth * 0.5, h: window.innerHeight * 0.5 };
    const cursor = { x: 0, y: 0 };
    const rows = 11;
    const grid = [rows, rows];
    const from = 'center';
    const scaleStagger = stagger([2, 5], { ease: 'inQuad', grid, from });
    const opacityStagger = stagger([1, 0.1], { grid, from });

    for (let i = 0; i < (rows * rows); i++) {
      creatureEl.appendChild(document.createElement('div'));
    }

    const particuleEls = creatureEl.querySelectorAll('div');

    utils.set(creatureEl, {
      width: rows * 10 + 'em',
      height: rows * 10 + 'em'
    });

    utils.set(particuleEls, {
      x: 0,
      y: 0,
      scale: scaleStagger,
      opacity: opacityStagger,
      background: stagger([60, 30], { grid, from,
        modifier: v => `hsl(45, 100%, ${v}%)`,
      }),
      boxShadow: stagger([4, 0.5], { grid, from,
        modifier: v => `0px 0px ${utils.round(v, 0)}em 0px hsla(45, 100%, 50%, 0.3)`,
      }),
      zIndex: stagger([rows * rows, 1], { grid, from, modifier: utils.round(0) }),
    });

    const pulse = () => {
      animate(particuleEls, {
        keyframes: [
          { scale: 5, opacity: 1, delay: stagger(80, { start: 1500, grid, from }), duration: 150 },
          { scale: scaleStagger, opacity: opacityStagger, ease: 'inOutQuad', duration: 600 }
        ],
      });
    }

    const mainLoop = createTimer({
      frameRate: 15,
      onUpdate: () => {
        animate(particuleEls, {
          x: cursor.x,
          y: cursor.y,
          delay: stagger(35, { grid, from }),
          duration: stagger(110, { start: 700, ease: 'inQuad', grid, from }),
          ease: 'inOut',
          composition: 'blend',
        });
      }
    });

    const autoMove = createTimeline()
      .add(cursor, {
        x: [-viewport.w * 0.45, viewport.w * 0.45],
        modifier: x => x + Math.sin(mainLoop.currentTime * 0.0007) * viewport.w * 0.5,
        duration: 3000,
        ease: 'inOutExpo',
        alternate: true,
        loop: true,
        onBegin: pulse,
        onLoop: pulse,
      }, 0)
      .add(cursor, {
        y: [-viewport.h * 0.45, viewport.h * 0.45],
        modifier: y => y + Math.cos(mainLoop.currentTime * 0.00012) * viewport.h * 0.5,
        duration: 1000,
        ease: 'inOutQuad',
        alternate: true,
        loop: true,
      }, 0);

    const manualMovementTimeout = createTimer({
      duration: 1500,
      onComplete: () => autoMove.play(),
    });

    const followPointer = e => {
      const event = e.type === 'touchmove' ? e.touches[0] : e;
      cursor.x = event.pageX - viewport.w;
      cursor.y = event.pageY - viewport.h;
      autoMove.pause();
      manualMovementTimeout.restart();
    };

    document.addEventListener('mousemove', followPointer);
    document.addEventListener('touchmove', followPointer);
  </script>

  <script>

    const steps = [
      { 
        bg: "./img/spices2.jpg", 
        title: "Discover Premium Spices", 
        text: "Hand-picked spices from around the world, curated for true flavor lovers.",
        features: ["✓ 100% Natural", "✓ Fresh Ground", "✓ Fast Shipping"]
      },
      { 
        bg: "./img/spices3.jpg", 
        title: "Authentic Global Flavors", 
        text: "From Indian curry blends to Mexican chilies, explore authentic spices that bring the world to your kitchen.",
        features: ["✓ Ethically Sourced", "✓ Small Batch", "✓ Quality Tested"]
      },
      { 
        bg: "./img/spices1.jpg", 
        title: "Delivered Fresh To You", 
        text: "We ensure every spice reaches your kitchen pure, aromatic, and full of life.",
        features: ["✓ Airtight Sealed", "✓ 2-Day Shipping", "✓ Money Back"]
      },
      { 
        bg: "https://images.unsplash.com/photo-1556909212-d5b604d0c90d?w=800", 
        title: "Cook & Enjoy!", 
        text: "Turn every meal into a feast of flavor. Cook with love, spice with us!",
        features: ["✓ Recipe Cards", "✓ Expert Tips", "✓ 24/7 Support"]
      }
    ];

    let currentStep = 0;
    const bgEl = document.getElementById("onboard-bg");
    const titleEl = document.getElementById("onboard-title");
    const textEl = document.getElementById("onboard-text");
    const dotsContainer = document.getElementById("dots-container");
    const nextBtn = document.getElementById("next-btn");
    const prevBtn = document.getElementById("prev-btn");
    const progressFill = document.getElementById("progress-fill");
    const featureBadges = document.getElementById("feature-badges");

    // Create dots dynamically
    dotsContainer.innerHTML = '';
    steps.forEach((_, i) => {
      const dot = document.createElement('span');
      dot.className = 'dot' + (i === 0 ? ' active' : '');
      dot.addEventListener('click', () => goToStep(i));
      dotsContainer.appendChild(dot);
    });
    const dots = dotsContainer.querySelectorAll('.dot');

    // Preload images
    steps.forEach(step => { 
      const img = new Image(); 
      img.src = step.bg; 
    });

    function updateStep(stepIndex, direction = 'forward') {
      const { bg, title, text, features } = steps[stepIndex];
      
      // Animate out
      bgEl.style.opacity = '0';
      bgEl.style.transform = direction === 'forward' ? 'scale(1.1)' : 'scale(0.95)';
      document.querySelector('.content').style.opacity = '0';
      document.querySelector('.content').style.transform = 'translateY(10px)';

      setTimeout(() => {
        bgEl.style.backgroundImage = `url(${bg})`;
        titleEl.textContent = title;
        textEl.textContent = text;
        
        // Update feature badges
        featureBadges.innerHTML = '';
        features.forEach(feature => {
          const badge = document.createElement('div');
          badge.className = 'feature-badge';
          badge.textContent = feature;
          featureBadges.appendChild(badge);
        });
        
        dots.forEach((dot, i) => dot.classList.toggle("active", i === stepIndex));
        nextBtn.textContent = stepIndex === steps.length - 1 ? "Get Started" : "Next";
        prevBtn.disabled = stepIndex === 0;
        
        // Update progress bar
        const progress = ((stepIndex + 1) / steps.length) * 100;
        progressFill.style.width = progress + '%';
        
        // Animate in
        bgEl.style.opacity = '1';
        bgEl.style.transform = 'scale(1)';
        document.querySelector('.content').style.opacity = '1';
        document.querySelector('.content').style.transform = 'translateY(0)';
      }, 300);
    }

    function goToStep(index) {
      if (index === currentStep) return;
      const direction = index > currentStep ? 'forward' : 'backward';
      currentStep = index;
      updateStep(currentStep, direction);
    }

    nextBtn.addEventListener("click", () => {
      if (currentStep < steps.length - 1) {
        currentStep++;
        updateStep(currentStep, 'forward');
      } else {
        window.location.href = "register.html";
      }
    });

    prevBtn.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        updateStep(currentStep, 'backward');
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' && currentStep < steps.length - 1) {
        currentStep++;
        updateStep(currentStep, 'forward');
      } else if (e.key === 'ArrowLeft' && currentStep > 0) {
        currentStep--;
        updateStep(currentStep, 'backward');
      }
    });

    // Touch swipe support
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      if (touchEndX < touchStartX - 50 && currentStep < steps.length - 1) {
        currentStep++;
        updateStep(currentStep, 'forward');
      }
      if (touchEndX > touchStartX + 50 && currentStep > 0) {
        currentStep--;
        updateStep(currentStep, 'backward');
      }
    }

    updateStep(0);
  </script>
</body>
</html>